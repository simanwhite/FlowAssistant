<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <title>work_process-JIRA265</title>
        <link type="text/css" rel="stylesheet" href="appbase.css">
    </head>
    <body class="wikidpad">
<span class="wikidpad parent-nodes">parent nodes: <span class="wikidpad parent-node"><a href="calendar_Sept_2016.html" class="wikidpad">calendar_Sept_2016</a></span> | <span class="wikidpad parent-node"><a href="work%20projects.html" class="wikidpad">work projects</a></span> | <span class="wikidpad parent-node"><a href="work_process-JIRA305.html" class="wikidpad">work_process-JIRA305</a></span> | <span class="wikidpad parent-node"><a href="运行环境收集.html" class="wikidpad">运行环境收集</a></span><br class="wikidpad" /><br class="wikidpad" /></span>
<a name=".h0" class="wikidpad"></a><h2 class="wikidpad heading-level2">work_process-JIRA265</h2>
<hr class="wikidpad" />
标题: Make MON power switch control port flexible<br class="wikidpad" />
JIRA地址: <br class="wikidpad" />
<span class="wikidpad url-link"><a href="http://ontrack-internal.amd.com/browse/DMVMTVRF-265?jql=project%20%3D%20DMVMTVRF" class="wikidpad">http://ontrack-internal.amd.com/browse/DMVMTVRF-265?jql=project%20%3D%20DMVMTVRF</a></span><br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<a name=".h246" class="wikidpad"></a><h3 class="wikidpad heading-level3">状态及下一步(newest on top)</h3>
<hr class="wikidpad" />
<ol class="wikidpad orderedlist">
<li class="wikidpad" /><br class="wikidpad" />
<br class="wikidpad" />
</ol>
<a name=".h359" class="wikidpad"></a><h3 class="wikidpad heading-level3">环境及问题描述</h3>
<hr class="wikidpad" />
<b class="wikidpad">环境</b>:<br class="wikidpad" />
vnc srdcws018:5 123456<br class="wikidpad" />
/local_vol1_nobackup/user/yizhang/gfxip_gf<br class="wikidpad" />
cpf.params PG_MON_SW_EN2 定义的东西要拿到power.tmpl -&gt; sub mon_port_mapping<br class="wikidpad" />
-&gt; mon_block.upf2.tmpl<br class="wikidpad" />
Reporter: Zhang Yi<br class="wikidpad" />
<br class="wikidpad" />
$DJ命令$:<br class="wikidpad" />
<br class="wikidpad" />
dj -DUSE_FDL -DGENERATE_GLOBAL_FEATURES -DRELAX_FEATURE_ACCESS_CKS 
<ul class="wikidpad normalindent">-DNO_LEGACY_GEN_DVFLOWS -v -m -c -DSKIP_EMU_PG -DUSE_VRQ -l 
gcpg_cgpg_sanity_gfxip.log -e 
'run_test "gcpg/gcpg_cgpg_sanity_gfxip  -DPG_ASSERT -DPOWER_GATING -D RUN_GC_SIM"' 
-DPG_CG_W2E -DCG_W2E -DUSE_NLP<br class="wikidpad" />
<br class="wikidpad" />
</ul>
<b class="wikidpad">问题描述</b>:<br class="wikidpad" />
有一些东西写死了, 要从用户的param里拿<br class="wikidpad" />
JIRA描述:<br class="wikidpad" />
Now MON power switch control port is fixed at one specific port. This is OK in r<br class="wikidpad" />
aven1x. But in raven2x, this port is removed. The port needs to be flexible. The<ul class="wikidpad normalindent">script should be improved instead of using one fixed port.<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
</ul>
<a name=".h1198" class="wikidpad"></a><h3 class="wikidpad heading-level3">日志(oldest on top)</h3>
<hr class="wikidpad" />
<a name=".h1301" class="wikidpad"></a><h4 class="wikidpad heading-level4">2016-9-18</h4>
问题分析:<br class="wikidpad" />
IP项目, 调用Makefile.body -&gt; power.tmpl<br class="wikidpad" />
power.tmpl中sub mon_port_mapping中, mon_sw_en1/2已经被写死<ul class="wikidpad normalindent">$mon_sw_en1 = "gc/bpm_ea0/TTOP_P2_daughter_sleep";<br class="wikidpad" />
$mon_sw_en2 = "gc/bpm_ea0/TTOP_P2_mother_sleep";<br class="wikidpad" />
<br class="wikidpad" />
</ul>
<a name=".h1514" class="wikidpad"></a><h4 class="wikidpad heading-level4">2016-9-19</h4>
问题归结为, 怎样在power.tmpl中拿到block的params<br class="wikidpad" />
<br class="wikidpad" />
mon_inst长这样:<br class="wikidpad" />
$VAR1 = {<ul class="wikidpad normalindent">'bpmh_tci' =&gt; {<ul class="wikidpad normalindent">'core/gc/tc/tci_bpmh' =&gt; {<ul class="wikidpad normalindent">'pgfsm' =&gt; 'core/gc/cp/bpm_cpg',<br class="wikidpad" />
'paramFile' =&gt; '/local_vol1_nobackup/user/yizhang/gfxip_gfx9_for_raven2x_2/out/linux_2.6.18_64.VCS/raven2x/library/gc-raven2x/pub/src/meta/dfp/pg_params/bpmh_tci.params',<br class="wikidpad" />
'monBlks' =&gt; undef</ul>
<ul class="wikidpad normalindent">}</ul>
</ul>
<ul class="wikidpad normalindent">},</ul>
'cpaxi' =&gt; {<ul class="wikidpad normalindent">'core/gc/cp/cpaxi' =&gt; {<ul class="wikidpad normalindent">'paramFile' =&gt; '/local_vol1_nobackup/user/yizhang/gfxip_gfx9_for_raven2x_2/out/linux_2.6.18_64.VCS/raven2x/library/gc-raven2x/pub/src/meta/dfp/pg_params/cpaxi.params',<br class="wikidpad" />
'monBlks' =&gt; undef,<br class="wikidpad" />
'pgfsm' =&gt; 'core/gc/cp/bpm_cpg'</ul>
<ul class="wikidpad normalindent">}</ul>
</ul>
<ul class="wikidpad normalindent">},</ul>
</ul>
<ul class="wikidpad normalindent">...</ul>
<ul class="wikidpad normalindent">}<br class="wikidpad" />
</ul>
通常'paramFile'被用到都是在power.tmpl调用的下一层, 作为Xeperl的参数文件-p进去的.<br class="wikidpad" />
power.tmpl这一层不会取paramFile里面的内容. <br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<a name=".h2736" class="wikidpad"></a><h4 class="wikidpad heading-level4">2016-9-22</h4>
昨天的sync up meeting, Angela有讲解, 这个JIRA是否解决应该看两个地方:<ul class="wikidpad normalindent">top层的upf,<br class="wikidpad" />
mon block的upf.<br class="wikidpad" />
</ul>
<a name=".h2829" class="wikidpad"></a><h4 class="wikidpad heading-level4">2016-9-27</h4>
后续问题:<br class="wikidpad" />
<br class="wikidpad" />
In tb.upf.2.0, the logic port is defined and connected.<br class="wikidpad" />
connect_logic_net TTOP_P1_retention_1 -ports<br class="wikidpad" />
{gc/cp/bpm_cpc/TTOP_P1_bpm_retention}<br class="wikidpad" />
But in bpm_cpc.upf.2.0, the logic port is not defined, so below error is reported.<br class="wikidpad" />
Error-[UPF_ONF] Object not found<br class="wikidpad" />
tb.upf.2.0, 2063<br class="wikidpad" />
'tb/core/gc/cp/bpm_cpc/TTOP_P1_bpm_retention' specified with '-ports' option<br class="wikidpad" />
of 'connect_logic_net' command could not be resolved to any valid design<br class="wikidpad" />
element.<br class="wikidpad" />
No LogicPort found with name 'TTOP_P1_bpm_retention' in scope<br class="wikidpad" />
'tb/core/gc/cp/bpm_cpc' (Module: 'bpm_cpc',<br class="wikidpad" />
/local_vol1_nobackup/user/yizhang/gfxip_gfx9_for_raven2x_2/out/<br class="wikidpad" />
linux_2.6.18_64.VCS/raven2x/config/gc/pub/sim/publish/tiles/tile/<br class="wikidpad" />
core/publish_rtl/bpm_cpc.v, 31).<br class="wikidpad" />
<br class="wikidpad" />
在tb.upf.2.0中定义并连接的logic port在下层的upf中并没有被定义. <br class="wikidpad" />
gc/cp/bpm_cpc/TTOP_P1_bpm_retention<br class="wikidpad" />
在bpm_cpc.upf.2.0中没有定义<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<a name=".h3658" class="wikidpad"></a><h4 class="wikidpad heading-level4">2016-9-29</h4>
继续后续问题317:<br class="wikidpad" />
# power.tmpl debug line 2498 blk_p:<br class="wikidpad" />
$VAR1 = {<ul class="wikidpad normalindent">'type' =&gt; 'gc',<br class="wikidpad" />
'CONTROL' =&gt; {<ul class="wikidpad normalindent">'CGPG_P1_RET_SAVE_CONTROL' =&gt; ' gc/upg_ctrl_signal_wrapper_0/oPWR_MON_rtn_en:TTOP_P1_bpm_retention ',<br class="wikidpad" />
'PG_MON_SW_EN1' =&gt; 'P2_daughter_sleep',<br class="wikidpad" />
'P1_ISO_CONTROL' =&gt; 'TTOP_P1_bpm_iso_clampn'</ul>
<ul class="wikidpad normalindent">},</ul>
'paramFile' =&gt; '/local_vol1_nobackup/user/yizhang/gfxip_gfx9_for_raven2x_2/out/linux_2.6.18_64.VCS/raven2x/library/gc-raven2x/pub/src/meta/dfp/pg_params/bpm_cpc.params',<br class="wikidpad" />
'PDList' =&gt; {<ul class="wikidpad normalindent">'PD_M1' =&gt; '',<br class="wikidpad" />
'PD_M2' =&gt; '0',<br class="wikidpad" />
'PD_P1' =&gt; '',<br class="wikidpad" />
'PD_GLB' =&gt; '0',<br class="wikidpad" />
'PD_P2' =&gt; ''</ul>
<ul class="wikidpad normalindent">}</ul>
</ul>
<ul class="wikidpad normalindent">};<br class="wikidpad" />
</ul>
最终是用户配置问题. bpm_cpc.params这个block里面, 加了:<ul class="wikidpad normalindent">CGPG_P1_RET_SAVE_CONTROL = xxxx</ul>
这个port, 这会让xxxx这个port出现在tb.upf.2.0里. 但是没有把这个port加到VIRTUAL_PORT<br class="wikidpad" />
里面, 所以不会在bpm_cpc.upf.2.0里被create. 于是产生错误. <br class="wikidpad" />
总之是用户配置问题. <br class="wikidpad" />
详细思路可见2016-9-28 JIRA265的草稿纸. <br class="wikidpad" />
<br class="wikidpad" />
这个应该可以写进twiki里. 所以:<br class="wikidpad" />
<br class="wikidpad" />
TODO: 把用户配置这个问题写进twiki里<br class="wikidpad" />
TODO: 把脚本修改发布出去<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<a name=".h4791" class="wikidpad"></a><h4 class="wikidpad heading-level4">2016-10-9</h4>
后续问题321<br class="wikidpad" />
In release_test_jira265, below two line is generated in upf isolation.<br class="wikidpad" />
-source SS_VDDGFX_P1 
-diff_supply_only TRUE 
In raven1x, this two line is kept for SOC but removed in IP.<br class="wikidpad" />
And in gfxip upf, SS_VDDGFX_P1 is an unconnected source.<br class="wikidpad" />
<br class="wikidpad" />
涉及文件: mon_block.upf2.tmpl<br class="wikidpad" />
<br class="wikidpad" />
但是从2016年1月份开始就是这么做的. Angela确认这样没问题. VCS2015应该是支持<br class="wikidpad" />
<b class="wikidpad">异构</b>的.<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
后续问题322 <br class="wikidpad" />
Hi, Quan You also need to change to default control port to daughter_sleep<ul class="wikidpad normalindent">instead of mother_sleep.<br class="wikidpad" />
<br class="wikidpad" />
</ul>
<a name=".h5249" class="wikidpad"></a><h4 class="wikidpad heading-level4">2016-10-10</h4>
接昨天, 把cgpg_block.upf2.tmpl里面<br class="wikidpad" />
#-------------------------------------------------------------------<br class="wikidpad" />
# power switch for PD_VDDGFX_P1 <br class="wikidpad" />
#-------------------------------------------------------------------<pre class="wikidpad">&lt;:  
my @psw_1 = split(/;/, $PG_P1_SW_EN1);
my @psw_2 = split(/;/, $PG_P1_SW_EN2);
for $i (0..$#psw_1) {
	    $PG_P1_SW_EN1 = $psw_1[$i]; 

        print "create_power_switch SW_VDDGFX_P1_${i} \\\n";
        print " -domain PD_VDDGFX_P1 \\\n";
        print " -input_supply_port {vin $POWER_BLOCK} \\\n";
        print " -output_supply_port {vout VDDGFX_P1} \\\n";
        print " -control_port { $MOTH_PORT $PG_P1_SW_EN1} \\\n";  #这里的EN1
        # 改成了EN2
</pre>
<br class="wikidpad" />
<br class="wikidpad" />
<a name=".h5933" class="wikidpad"></a><h4 class="wikidpad heading-level4">2016-10-11</h4>
atlnonveu-0629:/proj/cv_srdc/qzuo/powerflow_jira265[ 61 ] --&gt; p4 shelve -c 2498140<br class="wikidpad" />
Shelving files for change 2498140.<br class="wikidpad" />
edit //tools/internal/powerflow/main/src/template/mon_block.upf2.tmpl#40<br class="wikidpad" />
edit //tools/internal/powerflow/main/src/template/power.tmpl#31<br class="wikidpad" />
Change 2498140 files shelved.<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<br class="wikidpad" />
<hr class="wikidpad" />
<hr class="wikidpad" />
<span class="wikidpad property attribute">[alias: work_process-JIRA317]</span><br class="wikidpad" />
    </body>
</html>
